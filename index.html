<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Safe Tab Opener</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom scrollbar */
        textarea::-webkit-scrollbar {
            width: 8px;
        }
        textarea::-webkit-scrollbar-track {
            background: #2d3748;
        }
        textarea::-webkit-scrollbar-thumb {
            background-color: #4a5568;
            border-radius: 4px;
        }
        /* Style for disabled buttons */
        button:disabled {
            cursor: not-allowed;
            opacity: 0.5;
        }
        /* Keyframes for the error shake animation */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        /* Class to apply the shake animation and a red border */
        .error-shake {
            animation: shake 0.5s ease-in-out;
            border-color: #ef4444; /* Red-500 */
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-5xl mx-auto">
        <div class="bg-gray-800 border border-gray-700 rounded-lg shadow-lg p-6">
            
            <div class="text-center mb-6">
                <h1 class="text-2xl sm:text-3xl font-bold text-white">Safe Tab Opener</h1>
                <p class="text-gray-400 mt-2">Simulate human behavior to avoid being flagged.</p>
            </div>

            <div class="space-y-6">
                <!-- URL Input Section with side-by-side preview -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="urls" class="block text-sm font-medium text-gray-300 mb-2">Paste URLs (one per line)</label>
                        <textarea id="urls" rows="10" class="w-full bg-gray-900 border border-gray-600 rounded-md p-3 text-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out" placeholder="https://www.google.com&#10;https://www.github.com&#10;https://www.example.com"></textarea>
                    </div>
                    <!-- Shuffled Preview Area -->
                    <div id="shuffle-preview-container" style="display: none;">
                        <label for="shuffled-urls-preview" class="block text-sm font-medium text-gray-400 mb-2">Shuffled Order</label>
                        <textarea id="shuffled-urls-preview" rows="10" class="w-full bg-gray-900/50 border border-gray-700 rounded-md p-3 text-gray-400" readonly></textarea>
                    </div>
                </div>


                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label for="min-delay" class="block text-sm font-medium text-gray-300 mb-2">Minimum Delay (seconds):</label>
                        <input type="number" id="min-delay" value="7" min="0" class="w-full bg-gray-900 border border-gray-600 rounded-md p-3 text-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors">
                    </div>
                    <div>
                        <label for="max-delay" class="block text-sm font-medium text-gray-300 mb-2">Maximum Delay (seconds):</label>
                        <input type="number" id="max-delay" value="11" min="0" class="w-full bg-gray-900 border border-gray-600 rounded-md p-3 text-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors">
                    </div>
                </div>
                
                <div class="bg-gray-900/50 rounded-md p-3 border border-gray-700">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <input id="shuffle-urls" type="checkbox" class="h-4 w-4 rounded border-gray-500 bg-gray-700 text-blue-600 focus:ring-blue-600">
                            <label for="shuffle-urls" class="text-sm font-medium text-gray-300">Shuffle URL List</label>
                        </div>
                        <p id="estimate-time" class="text-sm text-gray-400 text-right"></p>
                    </div>
                </div>


                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                     <button id="start-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-blue-500 transition duration-150 ease-in-out">
                        Start Opening
                    </button>
                    <button id="stop-btn" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-red-500 transition duration-150 ease-in-out">
                        Stop
                    </button>
                </div>
            </div>

            <div id="status-container" class="mt-6 text-center p-4 bg-gray-900/50 border border-gray-700 rounded-md" style="display: none;">
                <p id="status-message" class="text-gray-300 min-h-[24px]"></p>
                <p id="countdown-timer" class="text-gray-400 text-sm min-h-[20px]"></p>
                <div id="progress-bar-container" class="w-full bg-gray-700 rounded-full h-2.5 mt-2" style="display:none;">
                    <div id="progress-bar" class="bg-blue-600 h-2.5 rounded-full" style="width: 0%; transition: width 0.5s ease-in-out;"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- DOM Element References ---
        const urlTextArea = document.getElementById('urls');
        const minDelayInput = document.getElementById('min-delay');
        const maxDelayInput = document.getElementById('max-delay');
        const shuffleCheckbox = document.getElementById('shuffle-urls');
        const estimateTimeDisplay = document.getElementById('estimate-time');
        const startButton = document.getElementById('start-btn');
        const stopButton = document.getElementById('stop-btn');
        const statusContainer = document.getElementById('status-container');
        const statusMessage = document.getElementById('status-message');
        const countdownTimer = document.getElementById('countdown-timer');
        const progressBar = document.getElementById('progress-bar');
        const progressBarContainer = document.getElementById('progress-bar-container');
        const shufflePreviewContainer = document.getElementById('shuffle-preview-container');
        const shufflePreviewTextarea = document.getElementById('shuffled-urls-preview');

        // --- State Variables ---
        let stopProcess = false;
        let countdownInterval;

        // --- Core Functions ---
        const sleep = (ms) => new Promise(resolve => setTimeout(resolve, ms));

        function initializeUI() {
            stopButton.disabled = true;
            startButton.disabled = false;
            shufflePreviewContainer.style.display = 'none'; // Hide preview on init
            updateEstimate();
        }

        function updateEstimate() {
            const urls = urlTextArea.value.split('\n').filter(url => url.trim());
            const urlCount = urls.length;
            const minDelay = parseFloat(minDelayInput.value) || 0;
            const maxDelay = parseFloat(maxDelayInput.value) || 0;

            if (urlCount < 2 || minDelay > maxDelay) {
                estimateTimeDisplay.textContent = '';
                return;
            }

            const avgDelay = (minDelay + maxDelay) / 2;
            const totalSeconds = (urlCount - 1) * avgDelay;
            
            if (totalSeconds <= 0) {
                 estimateTimeDisplay.textContent = '';
                return;
            }

            const minutes = Math.floor(totalSeconds / 60);
            const seconds = Math.round(totalSeconds % 60);

            let estimateString = "Est. time: ";
            if (minutes > 0) {
                estimateString += `${minutes}m `;
            }
            estimateString += `${seconds}s`;
            
            estimateTimeDisplay.textContent = estimateString;
        }

        function startCountdown(secondsRemaining) {
            if (countdownInterval) clearInterval(countdownInterval);
            statusMessage.textContent = `Waiting for ${secondsRemaining.toFixed(1)} seconds...`;
            const startTime = Date.now();
            const totalDurationMs = secondsRemaining * 1000;

            countdownInterval = setInterval(() => {
                const elapsedMs = Date.now() - startTime;
                const remainingMs = totalDurationMs - elapsedMs;
                if (remainingMs > 0) {
                    countdownTimer.textContent = `Next tab in ${(remainingMs / 1000).toFixed(1)}s`;
                } else {
                    countdownTimer.textContent = '';
                    clearInterval(countdownInterval);
                }
            }, 100);
        }

        /**
         * Animates the display of the shuffled list in the preview text area.
         * @param {string[]} urls - The array of shuffled URLs.
         */
        async function animateShufflePreview(urls) {
            shufflePreviewContainer.style.display = 'block';
            shufflePreviewTextarea.value = '';
            for (const url of urls) {
                if (stopProcess) break; // Allow stopping during this animation
                shufflePreviewTextarea.value += url + '\n';
                shufflePreviewTextarea.scrollTop = shufflePreviewTextarea.scrollHeight; // Auto-scroll
                await sleep(50); // Small delay for animation effect
            }
        }

        /**
         * Main processing function.
         */
        async function startProcessing() {
            // --- 1. Get and Validate Inputs ---
            let urls = urlTextArea.value.split('\n').map(url => url.trim()).filter(url => url && !url.startsWith('#'));
            const minDelay = parseFloat(minDelayInput.value);
            const maxDelay = parseFloat(maxDelayInput.value);
            
            statusContainer.style.display = 'block';

            if (urls.length === 0) {
                statusMessage.textContent = "Please provide at least one URL.";
                return;
            }
            if (isNaN(minDelay) || isNaN(maxDelay) || minDelay < 0 || maxDelay < 0) {
                statusMessage.textContent = "Please provide valid, non-negative numbers for delays.";
                return;
            }
            if (minDelay > maxDelay) {
                statusMessage.textContent = "Minimum delay cannot be greater than maximum delay.";
                minDelayInput.classList.add('error-shake');
                maxDelayInput.classList.add('error-shake');
                setTimeout(() => {
                    minDelayInput.classList.remove('error-shake');
                    maxDelayInput.classList.remove('error-shake');
                }, 500);
                return;
            }

            // --- 2. Setup UI for Processing ---
            stopProcess = false;
            startButton.disabled = true;
            stopButton.disabled = false;
            progressBarContainer.style.display = 'block';
            progressBar.style.width = '0%';
            statusMessage.textContent = 'Starting process...';
            countdownTimer.textContent = '';
            
            // --- 3. Shuffle if requested and show preview ---
            if (shuffleCheckbox.checked) {
                statusMessage.textContent = 'Shuffling URL list...';
                // Fisher-Yates shuffle algorithm
                for (let i = urls.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [urls[i], urls[j]] = [urls[j], urls[i]];
                }
                // Animate the display of the shuffled list
                await animateShufflePreview(urls);
                if(stopProcess) { // Check if user stopped during animation
                    initializeUI();
                    statusMessage.textContent = 'Process stopped by user.';
                    return;
                }
            } else {
                shufflePreviewContainer.style.display = 'none'; // Ensure preview is hidden if not shuffling
            }

            // --- 4. Asynchronous Loop ---
            for (let i = 0; i < urls.length; i++) {
                if (stopProcess) {
                    statusMessage.textContent = 'Process stopped by user.';
                    break;
                }
                const url = urls[i];
                const progressPercentage = ((i + 1) / urls.length) * 100;
                statusMessage.textContent = `Opening URL ${i + 1} of ${urls.length}: ${url}`;
                progressBar.style.width = `${progressPercentage}%`;
                window.open(url, '_blank');
                if (i < urls.length - 1) {
                    const delaySeconds = Math.random() * (maxDelay - minDelay) + minDelay;
                    startCountdown(delaySeconds);
                    await sleep(delaySeconds * 1000);
                }
            }

            // --- 5. Finalize and Reset UI ---
            if (countdownInterval) clearInterval(countdownInterval);
            countdownTimer.textContent = '';
            if (!stopProcess) {
                statusMessage.textContent = `Done! All ${urls.length} URLs have been opened.`;
            }
            initializeUI();
        }

        function stopProcessing() {
            stopProcess = true;
            if (countdownInterval) clearInterval(countdownInterval);
            countdownTimer.textContent = '';
            statusMessage.textContent = 'Process stopped by user.';
            stopButton.disabled = true;
        }

        // --- Event Listeners ---
        startButton.addEventListener('click', startProcessing);
        stopButton.addEventListener('click', stopProcessing);
        urlTextArea.addEventListener('input', updateEstimate);
        minDelayInput.addEventListener('input', updateEstimate);
        maxDelayInput.addEventListener('input', updateEstimate);
        
        // --- Initial Page Load ---
        document.addEventListener('DOMContentLoaded', initializeUI);
    </script>
</body>
</html>
